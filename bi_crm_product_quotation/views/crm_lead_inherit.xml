<?xml version="1.0"?>
<odoo>
    <record id="crm_lead_view_form_view_inherit" model="ir.ui.view">
        <field name="name">crm.lead.form</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="is_crm_quotation" invisible='1'/>
            </xpath>
            <xpath expr="//button[@name='action_set_lost']" position="before">
                <button string="New Details Quotation" name="action_quotations_view" type="object" class="oe_highlight" attrs="{'invisible': ['|','|', ('type', '=', 'lead'), '&amp;', ('probability', '=', 0), ('active', '=', False),('is_crm_quotation', '=', True)]}"/> 
            </xpath>
            <xpath expr="//button[@name='action_schedule_meeting']" position="before">
                <button class="oe_stat_button" type="object"
                        name="open_quotation_from_view_action" icon="fa-pencil-square-o" attrs="{'invisible': ['|','|', ('type', '=', 'lead'), '&amp;', ('probability', '=', 0), ('active', '=', False),('is_crm_quotation', '=', True)]}">
                        <field name="crm_count" string="Quotations" widget="statinfo" attrs="{'invisible': ['|','|', ('type', '=', 'lead'), '&amp;', ('probability', '=', 0), ('active', '=', False),('is_crm_quotation', '=', True)]}"/>
                </button> 
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page string = "Products">
                    <field name="lead_product_ids" nolabel="1">
                        <tree editable="bottom" string="Products">
                            <field name="product_id"/>
                            <field name="name"/>
                            <field name="product_uom_quantity"/>
                            <field name="product_uom"/>
                            <field name="price_unit"/>
                            <field name="tax_id" widget="many2many_tags"/>
                            <field name="product_uom_category_id" invisible="1"/>
                        </tree>
                    </field>
                </page>
            </xpath>
              <!-- Modify the 'tag_ids' field's attributes and make it invisible -->
                <xpath expr="//field[@name='tag_ids']" position="attributes">
                    <attribute name="attrs">{}</attribute>
                    <attribute name="invisible">1</attribute>
                    <attribute name="options">{"color_field": "color", "no_create_edit": true, "no_create": true}</attribute>
                </xpath>

                <!-- Add the 'Segment' and 'Machine Type' fields after the 'tag_ids' field -->
                <xpath expr="//field[@name='tag_ids']" position="after">
                    <field widget="many2many_tags"  string="Segment"/>
                    <field name="machine_type" string="Machine Type"/>
                </xpath>

                <!-- Add the 'Machine Type' field after the 'tag_ids' inside the 'lead_priority' group -->
                <xpath expr="//group[@name='lead_priority']/field[@name='tag_ids']" position="after">
                    <field name="machine_type" string="Machine Type"/>
                </xpath>
            <!-- <xpath expr="//field[@name='tag_ids']" position="attributes">
                <attribute name="string">Segment</attribute>
            </xpath>
            
            <xpath expr="//field[@name='tag_ids']" position="after">
                <field name="machine_type" />
            </xpath> -->
        </field>
    </record>

    <record model="ir.actions.act_window" id="open_crm_opportunity_action">
        <field name="name">Pipeline</field>
        <field name="res_model">crm.lead</field>
        <field name="view_mode">kanban,tree,graph,pivot,form,calendar,activity</field>
        <field name="domain">[('type','=','opportunity'), ('is_crm_quotation','=',True)]</field>
        <field name="context">{
                    'default_type': 'opportunity',
                    'search_default_assigned_to_me': 1,
                    'default_is_crm_quotation': True
        }</field>
        <field name="search_view_id" ref="crm.view_crm_case_opportunities_filter"/>
    </record>


     <record id="view_crm_stage_form_inherit" model="ir.ui.view">
            <field name="name">crm.stage.form.inherit</field>
            <field name="model">crm.stage</field>
            <field name="inherit_id" ref="crm.crm_stage_form" />
            <field name="arch" type="xml">
            <xpath expr="//field[@name='is_won']" position="after">
                  <field name="is_lost"/>
            </xpath>
            </field>
        </record>    

</odoo>
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="purchase_order_tree" model="ir.ui.view">
        <field name="name">purchase.order.tree</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_view_tree"/>
        <field name="arch" type="xml">
            <field name="invoice_status" position="before">
                <field name="reception_status" optional="hide" widget="badge"
                    decoration-danger="reception_status == 'force_closure'"
                    decoration-info="reception_status == 'partiall_delivered'"/>
            </field>
        </field>
    </record>

    <record id="purchase_order_line_tree" model="ir.ui.view">
        <field name="name">purchase.order.line.tree.inherit.partial.purchase.overview</field>
        <field name="model">purchase.order.line</field>
        <field name="arch" type="xml">
            <tree string="Purchase Order Lines" create="0" delete="0" expand="1"
                decoration-danger="undelivered_products == True">
                <field name="state" invisible="1"/>
                <field name="is_order_open" invisible="1"/>
                <field name="undelivered_products" invisible="1"/>
                <field name="sequence" widget="handle"/>
                <field name="partner_id" optional="hide"/>
                <field name="order_id"/>
                <field name="product_id" optional="hide"/>
                <field name="name"/>
                <field name="product_qty" string="Ordered Qty" optional="hide"/>
                <field name="qty_received" string="Received" optional="hide"/>
                <field name="partial_qty_to_receive"/>
                <field name="pending_qty"/>
                <field name="product_uom" string="UoM" groups="uom.group_uom" optional="hide"/>
                <field name="price_unit" optional="hide"/>
                <field name="price_subtotal" widget="monetary" optional="hide"/>
                <field name="order_reception_status" optional="hide" widget="badge"
                    decoration-danger="order_reception_status == 'force_closure'"
                    decoration-info="order_reception_status == 'partiall_delivered'"/>
            </tree>
        </field>
    </record>

      <record id="purchase_order_line_search" model="ir.ui.view">
        <field name="name">purchase.order.line.search</field>
        <field name="model">purchase.order.line</field>
        <field name="arch" type="xml">
            <search string="Search Purchase Order">
                <field name="order_id"/>
                <field name="product_id"/>
                <field name="partner_id" string="Vendor" filter_domain="[('partner_id', 'child_of', self)]"/>
                <filter name="undelivered_products" string="Force Closure" domain="[('order_reception_status', '=', 'force_closure')]"/>
                <filter name="delivered_products" string="Partially Delivered" domain="[('order_reception_status', '=', 'partiall_delivered')]"/>
                <group expand="1" string="Group By">
                    <filter name="groupby_supplier" string="Vendor" domain="[]" context="{'group_by' : 'partner_id'}" />
                    <filter name="groupby_product" string="Product" domain="[]" context="{'group_by' : 'product_id'}" />
                    <filter string="Order Reference" name="order_reference" domain="[]" context="{'group_by' :'order_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_partial_purchase_overview" model="ir.actions.act_window">
        <field name="name">Partial Purchase Overview</field>
        <field name="res_model">purchase.order.line</field>
        <field name="view_id" ref="purchase_order_line_tree"/>
        <field name="search_view_id" ref="purchase_order_line_search"/>
        <field name="view_mode">tree</field>
        <field name="domain">[
            ('state', 'in', ('purchase', 'done')), ('is_order_open', '=', True),
            ('qty_received_method', '=', 'stock_moves'),
            '|', ('partial_qty_to_receive', '>', 0), ('pending_qty', '>', 0),
        ]</field>
        <field name="context">{
            "search_default_order_reference": 1,
        }</field>
    </record>

    <menuitem id="partial_purchase_report" name="Partial Purchase Overview"
        parent="purchase.purchase_report_main" action="action_partial_purchase_overview"
        groups="purchase.group_purchase_manager" sequence="100"/>

</odoo>
